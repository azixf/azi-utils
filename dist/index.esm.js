var t;!function(t){t.version="1.0.0"}(t||(t={}));const e=t=>{const e=history[t];return function(){const r=e.apply(this,arguments),s=new Event(t);return window.dispatchEvent(s),r}},r=["click","dbclick","contextmenu","mousedown","mouseup","mouseenter","mouseout","mouseover"];class s{constructor(t){this.data=Object.assign(this.initDef(),t),this.installInnerReporter()}initDef(){return this.version=t.version,window.history.pushstate=e("pushState"),window.history.replaceState=e("replaceState"),{domReporter:!1,historyReporter:!1,hashReporter:!1,jsErroer:!1,repoterVersion:this.version}}setUserId(t){this.data.uuid=t}setExtraData(t){this.data.extraData=t}sendReporter(t){this.report(t)}report(t){const e=Object.assign(this.data,t,{time:Date.now()}),r=new Blob([JSON.stringify(e)],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(this.data.requestUrl,r)}installInnerReporter(){this.data.historyReporter&&(this.captureEvents(["pushstate"],"history-pv"),this.captureEvents(["replacestate"],"history-pv"),this.captureEvents(["popstate"],"history-pv")),this.data.hashReporter&&this.captureEvents(["hashchange"],"hash-pv"),this.data.domReporter&&this.targetReport(),this.data.jsErroer&&this.jsReport()}captureEvents(t,e,r){t.forEach((t=>{window.addEventListener(t,(()=>{this.report({event:t,targetKey:e,data:r})}))}))}targetReport(){r.forEach((t=>{window.addEventListener(t,(e=>{const r=e.target.getAttribute("target-key");r&&this.sendReporter({targetKey:r,event:t})}))}))}jsReport(){this.captureJsError(),this.capturePromiseReject()}captureJsError(){window.addEventListener("error",(t=>{this.sendReporter({targetKey:"js-error",event:"js",message:t.message})}))}capturePromiseReject(){window.addEventListener("unhandledrejection",(t=>{t.promise.catch((t=>{this.sendReporter({targetKey:"promise-error",event:"promise",message:t})}))}))}}class o{constructor(t){this.storage=window.localStorage,t&&(this.storage=window[t])}get(t){const e=this.storage.getItem(t);try{return e?JSON.parse(e):e}catch(t){return e}}set(t,e){this.storage.setItem(t,JSON.stringify(e))}remove(t){this.storage.removeItem(t)}clear(){this.storage.clear()}}function i(t,e=200,r=!1){let s;return function(...o){s&&(clearTimeout(s),s=null),r&&(r=!1,t.apply(this,o)),s=setTimeout((()=>{t.apply(this,o),clearTimeout(s),s=null}),e)}}function a(t,e=200,r=!1){let s;return function(...o){s||(r&&(r=!1,t.apply(this,o)),s=setTimeout((()=>{t.apply(this,o),clearTimeout(s),s=null}),e))}}const n=(t,e)=>{if(!t)return t;"string"==typeof t&&(t=t.replace("-","/"));const r=new Date(t);if(isNaN(r.getTime()))return console.error(`${t} is not a valid datelike parameter`),t;const s=r.getFullYear()+"",o=p({origin:r.getMonth()+1+""}),i=p({origin:r.getDate()+""}),a=p({origin:r.getHours()+""}),n=p({origin:r.getMinutes()+""}),c=p({origin:r.getSeconds()+""});return e.replace("YYYY",s).replace("MM",o).replace("DD",i).replace("hh",a).replace("mm",n).replace("ss",c)},p=t=>{const{origin:e,padding:r,length:s,position:o}=Object.assign({padding:"0",length:2,position:"end"},t);return"start"===o?e.padStart(s,r):e.padEnd(s,r)};export{s as Reporter,o as Storage,n as dateFormat,i as debounce,p as padString,a as throttle};
