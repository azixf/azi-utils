!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AziUtil={})}(this,(function(e){"use strict";var t;!function(e){e.version="1.0.0"}(t||(t={}));const r=e=>{const t=history[e];return function(){const r=t.apply(this,arguments),s=new Event(e);return window.dispatchEvent(s),r}},s=["click","dbclick","contextmenu","mousedown","mouseup","mouseenter","mouseout","mouseover"];e.Reporter=class{constructor(e){this.data=Object.assign(this.initDef(),e),this.installInnerReporter()}initDef(){return this.version=t.version,window.history.pushstate=r("pushState"),window.history.replaceState=r("replaceState"),{domReporter:!1,historyReporter:!1,hashReporter:!1,jsErroer:!1,repoterVersion:this.version}}setUserId(e){this.data.uuid=e}setExtraData(e){this.data.extraData=e}sendReporter(e){this.report(e)}report(e){const t=Object.assign(this.data,e,{time:Date.now()}),r=new Blob([JSON.stringify(t)],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(this.data.requestUrl,r)}installInnerReporter(){this.data.historyReporter&&(this.captureEvents(["pushstate"],"history-pv"),this.captureEvents(["replacestate"],"history-pv"),this.captureEvents(["popstate"],"history-pv")),this.data.hashReporter&&this.captureEvents(["hashchange"],"hash-pv"),this.data.domReporter&&this.targetReport(),this.data.jsErroer&&this.jsReport()}captureEvents(e,t,r){e.forEach((e=>{window.addEventListener(e,(()=>{this.report({event:e,targetKey:t,data:r})}))}))}targetReport(){s.forEach((e=>{window.addEventListener(e,(t=>{const r=t.target.getAttribute("target-key");r&&this.sendReporter({targetKey:r,event:e})}))}))}jsReport(){this.captureJsError(),this.capturePromiseReject()}captureJsError(){window.addEventListener("error",(e=>{this.sendReporter({targetKey:"js-error",event:"js",message:e.message})}))}capturePromiseReject(){window.addEventListener("unhandledrejection",(e=>{e.promise.catch((e=>{this.sendReporter({targetKey:"promise-error",event:"promise",message:e})}))}))}},e.Storage=class{constructor(e){this.storage=window.localStorage,e&&(this.storage=window[e])}get(e){const t=this.storage.getItem(e);try{return t?JSON.parse(t):t}catch(e){return t}}set(e,t){this.storage.setItem(e,JSON.stringify(t))}remove(e){this.storage.removeItem(e)}clear(){this.storage.clear()}},Object.defineProperty(e,"__esModule",{value:!0})}));
